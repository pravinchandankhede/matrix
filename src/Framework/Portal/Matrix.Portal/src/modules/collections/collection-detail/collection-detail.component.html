<div class="detail-container" *ngIf="collection">
  <div class="detail-header">
    <h2><mat-icon>collections_bookmark</mat-icon> {{ collection.name || 'New Collection' }}</h2>
    <button class="edit-btn" (click)="toggleEdit()">
      <mat-icon>{{ editMode() ? 'close' : 'edit' }}</mat-icon> {{ editMode() ? 'Cancel' : 'Edit' }}
    </button>
  </div>
  
  <div class="detail-content">
    <form *ngIf="editMode(); else viewMode" class="detail-form">
      <div class="form-row">
        <label>Collection UID:</label>
        <input type="text" [(ngModel)]="collection.dataSourceCollectionUId" name="dataSourceCollectionUId" />
      </div>
      <div class="form-row">
        <label>Name:</label>
        <input type="text" [(ngModel)]="collection.name" name="name" />
      </div>
      <div class="form-row">
        <label>Description:</label>
        <textarea [(ngModel)]="collection.description" name="description" rows="3"></textarea>
      </div>
      <div class="form-row">
        <label>Custom:</label>
        <select [(ngModel)]="collection.isCustom" name="isCustom">
          <option [value]="true">Yes</option>
          <option [value]="false">No</option>
        </select>
      </div>
      <div class="form-row">
        <label>Owner:</label>
        <input type="text" [(ngModel)]="collection.owner" name="owner" />
      </div>
      <div class="form-row">
        <label>Created By:</label>
        <input type="text" [(ngModel)]="collection.createdBy" name="createdBy" />
      </div>
      <div class="form-row">
        <label>Active:</label>
        <select [(ngModel)]="collection.isActive" name="isActive">
          <option [value]="true">Yes</option>
          <option [value]="false">No</option>
        </select>
      </div>
      <div class="form-row">
        <label>Tags:</label>
        <textarea [(ngModel)]="tagsString" name="tags" placeholder="Comma separated tags" rows="2"></textarea>
      </div>
      
      <div class="form-actions">
        <button type="button" class="btn-primary" (click)="onSave()">
          <mat-icon>save</mat-icon> Save
        </button>
        <button type="button" class="btn-secondary" (click)="onCancel()">
          <mat-icon>cancel</mat-icon> Cancel
        </button>
      </div>
    </form>
    
    <ng-template #viewMode>
      <div class="view-content">
        <div class="info-section">
          <h3>Collection Information</h3>
          <div class="info-row">
            <label>Collection UID:</label>
            <span class="uid">{{ collection.dataSourceCollectionUId }}</span>
          </div>
          <div class="info-row">
            <label>Name:</label>
            <span>{{ collection.name }}</span>
          </div>
          <div class="info-row" *ngIf="collection.description">
            <label>Description:</label>
            <span>{{ collection.description }}</span>
          </div>
          <div class="info-row">
            <label>Custom:</label>
            <span class="status" [class.active]="collection.isCustom" [class.inactive]="!collection.isCustom">
              {{ collection.isCustom ? 'Yes' : 'No' }}
            </span>
          </div>
          <div class="info-row">
            <label>Owner:</label>
            <span>{{ collection.owner }}</span>
          </div>
          <div class="info-row">
            <label>Active:</label>
            <span class="status" [class.active]="collection.isActive" [class.inactive]="!collection.isActive">
              {{ collection.isActive ? 'Yes' : 'No' }}
            </span>
          </div>
          <div class="info-row" *ngIf="collection.tags && collection.tags.length > 0">
            <label>Tags:</label>
            <div class="badge-container">
              <span *ngFor="let tag of collection.tags" class="tag-badge">{{ tag }}</span>
            </div>
          </div>
          <div class="info-row" (click)="onDataSourcesClick()" [class.clickable]="hasDataSources()">
            <label>Data Sources:</label>
            <span>{{ collection.dataSources.length || 0 }} data sources</span>
            <mat-icon *ngIf="hasDataSources()" class="chevron">chevron_right</mat-icon>
          </div>
          <div class="info-row">
            <label>Created:</label>
            <span>{{ collection.createdAt | date:'medium' }}</span>
          </div>
          <div class="info-row" *ngIf="collection.updatedAt">
            <label>Last Updated:</label>
            <span>{{ collection.updatedAt | date:'medium' }}</span>
          </div>
          <div class="info-row">
            <label>Created By:</label>
            <span>{{ collection.createdBy }}</span>
          </div>
          <div class="info-row" *ngIf="collection.updatedBy">
            <label>Updated By:</label>
            <span>{{ collection.updatedBy }}</span>
          </div>
        </div>
        
        <!-- Data Sources Section -->
        <div class="info-section" *ngIf="hasDataSources()">
          <h3>Data Sources ({{ collection.dataSources.length }})</h3>
          <div class="data-sources-list">
            <div class="data-source-item" *ngFor="let dataSource of collection.dataSources" (click)="onDataSourceSelected(dataSource.dataSourceUId)">
              <div class="data-source-header">
                <mat-icon>storage</mat-icon>
                <span class="data-source-name">{{ dataSource.name }}</span>
                <span class="data-source-type">{{ dataSource.type }}</span>
                <mat-icon class="chevron">chevron_right</mat-icon>
              </div>
              <div class="data-source-description" *ngIf="dataSource.description">
                {{ dataSource.description }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
  </div>
</div>
